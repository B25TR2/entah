<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keuangan Pribadi</title>
    <style>
        body { font-family: sans-serif; max-width: 500px; margin: 0 auto; padding: 20px; background: #f4f4f9; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 15px; text-align: center; }
        h1 { font-size: 18px; color: #555; }
        .saldo { font-size: 32px; font-weight: bold; color: #2ecc71; margin: 10px 0; }
        .stats { display: flex; justify-content: space-between; font-size: 14px; }
        .red { color: #e74c3c; } .green { color: #27ae60; }
        
        .input-group { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        input, select, button { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { background: #3498db; color: white; border: none; font-weight: bold; cursor: pointer; }
        button:hover { background: #2980b9; }

        .history-item { background: white; padding: 10px; margin-bottom: 8px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; font-size: 13px; }
        .history-meta { font-size: 10px; color: #888; }
    </style>
</head>
<body>

    <div class="card">
        <h1>Saldo Saat Ini</h1>
        <div class="saldo" id="saldo">Loading...</div>
        <div class="stats">
            <span class="green">Masuk: <span id="masuk">-</span></span>
            <span class="red">Keluar: <span id="keluar">-</span></span>
        </div>
    </div>

    <div class="input-group">
        <h3>Tambah Transaksi</h3>
        <select id="jenis">
            <option value="Pemasukan">ðŸ“¥ Pemasukan</option>
            <option value="Pengeluaran">ðŸ“¤ Pengeluaran</option>
        </select>
        <input type="number" id="nominal" placeholder="Nominal (contoh: 50000)">
        <input type="text" id="ket" placeholder="Keterangan (contoh: Makan)">
        <button onclick="kirimData()" id="btnKirim">Simpan Data</button>
    </div>

    <h3>Riwayat Terakhir</h3>
    <div id="riwayatList"></div>

    <script>
        // GANTI URL INI DENGAN HASIL DEPLOY GOOGLE SCRIPT ANDA
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwHhn-HgotWukaL-XK6ArgFqkLdgaB-YDFIX7fJtPvNbep78ZRv83WPXwbq_zPrjzuYkA/exec";

        // 1. Ambil Data saat Web Dibuka
        async function loadData() {
            try {
                let response = await fetch(SCRIPT_URL);
                let data = await response.json();
                
                document.getElementById("saldo").innerText = data.saldo;
                document.getElementById("masuk").innerText = data.masuk;
                document.getElementById("keluar").innerText = data.keluar;

                let html = "";
                data.riwayat.forEach(item => {
                    let warna = item.jenis == "Pemasukan" ? "green" : "red";
                    html += `
                        <div class="history-item" style="border-left: 4px solid ${warna == 'green' ? '#2ecc71' : '#e74c3c'}">
                            <div>
                                <strong>${item.ket}</strong><br>
                                <span class="history-meta">${item.tanggal}</span>
                            </div>
                            <div style="color: ${warna == 'green' ? '#27ae60' : '#c0392b'}; font-weight:bold;">
                                ${item.nominal}
                            </div>
                        </div>`;
                });
                document.getElementById("riwayatList").innerHTML = html;
            } catch (e) {
                console.log("Error:", e);
                document.getElementById("saldo").innerText = "Error Koneksi";
            }
        }

        // 2. Kirim Data ke Google Sheet
        function kirimData() {
            let jenis = document.getElementById("jenis").value;
            let nominal = document.getElementById("nominal").value;
            let ket = document.getElementById("ket").value;
            let btn = document.getElementById("btnKirim");

            if(!nominal) return alert("Isi nominal dulu!");

            btn.innerText = "Mengirim...";
            btn.disabled = true;

            // Gunakan mode no-cors untuk kirim data ke GAS (keterbatasan browser)
            // Atau pakai fetch POST biasa dengan payload text
            fetch(SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify({ action: "input_web", jenis, nominal, ket })
            }).then(() => {
                alert("Berhasil!");
                location.reload(); // Refresh halaman untuk update saldo
            }).catch(e => {
                alert("Gagal kirim.");
                btn.innerText = "Simpan Data";
                btn.disabled = false;
            });
        }

        // Jalankan saat load
        loadData();
    </script>
</body>
</html>
